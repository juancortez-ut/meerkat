var CALENDAR=function(){function e(e){l=$(e||"#cal"),i=l.find("#label"),l.find("#prev").bind("click.calendar",function(){t(!1),u--,0>u&&(u=11),a()}),l.find("#next").bind("click.calendar",function(){t(!0),u=(u+1)%12,a()}),i.bind("click",function(){t(null,(new Date).getMonth(),(new Date).getFullYear())}),i.click()}function t(e,t,a){var n,r=i.text().trim().split(" "),s=parseInt(r[1],10);t=t||(e?"December"===r[0]?0:o.indexOf(r[0])+1:"January"===r[0]?11:o.indexOf(r[0])-1),a=a||(e&&0===t?s+1:e||11!==t?s:s-1),n=c(a,t),$("#cal-frame",l).find(".curr").removeClass("curr").addClass("temp").end().prepend(n.calendar()).find(".temp").fadeOut("slow",function(){$(this).remove()}),$("#label").text(n.label)}function a(){numCalendarItems=s.calendar.length;for(var e=0;e<numCalendarItems;e++){calendarHtml=s.calendar[e];var t=n(calendarHtml.time);if(r(u+1)==t.month){var a=t.day;a=parseInt(a.replace(/^0+/,""));var c=$('td:contains("'+a+'")')[0];a==d.getDate()&&$(c).removeClass("today"),$(c).addClass("forest-green"),c.setAttribute("data-date",t.month+" "+a+" "+t.year),c.setAttribute("data-event",calendarHtml.event),calendarHtml.location&&c.setAttribute("data-location",calendarHtml.location),c.setAttribute("data-link",calendarHtml.link),$(c).css({cursor:"pointer"})}}}function n(e){var t=[],a=e.substring(0,e.indexOf("-"));e=e.substring(e.indexOf("-")+1,e.length);var n=e.substring(0,e.indexOf("-"));if(n=r(n),e=e.substring(e.indexOf("-")+1,e.length),day=e.substring(0,2),e.length>2){var c=e.substring(3,e.length),l=c.substring(0,5),i=parseInt(l.replace(/^0+/,""));if(i>=12){if(i>12){var s=l.substring(2,l.length),o=parseInt(l.substring(0,2))-12;l=o+s}i="P.M."}else i="A.M.";l=l.replace(/^0+/,""),t.startTime=l+" "+i}else t.startTime="";return t.month=n,t.day=day,t.year=a,t}function r(e){switch(e.length>1&&(e=parseInt(e.replace(/^0+/,""))),e){case 1:return"January";case 2:return"February";case 3:return"March";case 4:return"April";case 5:return"May";case 6:return"June";case 7:return"July";case 8:return"August";case 9:return"September";case 10:return"October";case 11:return"November";case 12:return"December";default:return"Invalid Month"}}function c(e,t){var a,n,r=1,l=!0,i=new Date(e,t,r).getDay(),s=[31,e%4===0&&e%100!==0||e%400===0?29:28,31,30,31,30,31,31,30,31,30,31],d=[];if(c.cache[e]){if(c.cache[e][t])return c.cache[e][t]}else c.cache[e]={};for(a=0;l;){for(d[a]=[],n=0;7>n;n++)0===a?n===i&&(d[a][n]=r++,i++):r<=s[t]?d[a][n]=r++:(d[a][n]="",l=!1),r>s[t]&&(l=!1);a++}if(d[5]){for(a=0;a<d[5].length;a++)""!==d[5][a]&&(d[4][a]="<span>"+d[4][a]+"</span><span>"+d[5][a]+"</span>");d=d.slice(0,5)}for(a=0;a<d.length;a++)d[a]="<tr><td>"+d[a].join("</td><td>")+"</td></tr>";return d=$("<table>"+d.join("")+"</table>").addClass("curr"),$("td:empty",d).addClass("nil"),t===(new Date).getMonth()&&$("td",d).filter(function(){return $(this).text()===(new Date).getDate().toString()}).addClass("today"),c.cache[e][t]={calendar:function(){return d.clone()},label:o[t]+" "+e},c.cache[e][t]}var l,i,s,o=["January","February","March","April","May","June","July","August","September","October","November","December"],d=new Date,u=d.getMonth();return $.ajax({method:"GET",url:"/calendardata"}).done(function(e){s=e,a()}),$(".glyphicon-remove-sign").click(function(){$("#cal-info").hide()}),$("#cal").click(function(e){if(e.originalEvent&&"forest-green"==e.toElement.classList[0]){if("glyphicon"==e.toElement.classList[0])return;var t=$(e.toElement).attr("data-event"),a=$(e.toElement).attr("data-location");if("undefined"!=typeof t&&t!==!1){var n=$(e.toElement).attr("data-event");$("#event").text(n);var r=$(e.toElement).attr("data-date");$("#date").text(r),"undefined"!=typeof a&&a!==!1?($(".locationWrapper").css({display:"block"}),$("#location").text(a)):$(".locationWrapper").css({display:"none"});var c=document.createElement("a");c.href=$(e.toElement).attr("data-link"),$("#calLink").wrap(c)}$("#cal-info").show()}}),c.cache={},{init:e,switchMonth:t,createCal:c}};