$(document).ready(function(){function e(){$("#title").empty(),$("#description").empty(),i<r&&($($("ol li")[i]).addClass("active"),$("#title").append(n.newsletter[i].title),$("#title").attr("title",n.newsletter[i].title),$("#description").append("<span class = 'bold'> Description: </span>"+n.newsletter[i].description),$("#image-newsletter").attr("src","../assets/newsletter/newsletter"+n.newsletter[i].image+"?v="+t),$("#image-newsletter").parent()[0].setAttribute("href",n.newsletter[i].image_link),n.newsletter[i].image_link?$("#image-newsletter").parent()[0].setAttribute("onclick","return true;"):$("#image-newsletter").parent()[0].setAttribute("onclick","return false;"))}var t,n,a,o=io(),i=0,r=0,c=0,s=0;o.emit("revision","Get revision number from backend."),o.on("revision",function(e){t=e});var l=setInterval(function(e){$("#next-newsletter").click()},5e3);"/"==window.location.pathname&&(ajaxUtils.getNewsletterData(t,function(e,t){return t?void console.error(t):(n=e.newsletterData,void(r=e.populatedItems))}),ajaxUtils.getCalendarData(function(e,t){return t?void console.error(t):(a=e.calendarData,void(c=e.numCalendarItems))}),ajaxUtils.getAnnouncements(function(e){e&&console.error(e)}),ajaxUtils.getOfficers(function(e){e&&console.error(e)}),ajaxUtils.getAuthentication(function(e){e&&console.error(e)})),ajaxUtils.postAnnouncement(function(e){e&&console.error(e)}),$("#login-form").submit(function(e){return ajaxUtils.login.call(this,e,function(e){e&&console.error(e)}),!1}),$(".fa-envelope-o").click(function(e){ajaxUtils.subscribe(function(e){e&&console.error(e)})}),$(".fa-envelope").click(function(){$("#subscribe-container").css({display:"flex"}),$("#newsletter-buttons").hide(),$(".fa-archive").hide(),$(this).hide(),clearInterval(l)}),$("#close-subscribe").click(function(){$("#subscribe-container").css({display:"none"}),$("#newsletter-buttons").show(),$(".fa-archive").show(),$(".fa-envelope").show(),$("#stat").text("Subscribe to our newsletter!"),$("#stat").css({color:"black"})}),$(".cal-button").on("click",function(e){$(e.currentTarget).hasClass("fa-angle-double-right")?s=(s+1)%c:(s--,s<0&&(s=c-1)),$(".fa-calendar").toggleClass("dark-shpe-blue mid-blue"),calendarHtml=a.calendar[s],$("#event-title").html("<b>Event: </b>"+calendarHtml.event),$("span.title").text(calendarHtml.event);var t,n=ajaxUtils._parseCalendarTime(calendarHtml.time);n.startTime?($("#event-date").html("<b>Date: </b>"+n.month+" "+n.day+", "+n.year+" at "+n.startTime),t=ajaxUtils._convertToDateFormat(n.month,n.day,n.year,n.startTime),$("span.start").text(t),$("span.end").text(t)):($("#event-date").html("<b>Date: </b>"+n.month+" "+n.day+", "+n.year),t=ajaxUtils._convertToDateFormat(n.month,n.day,n.year,n.startTime,""),$("span.start").text(t),$("span.end").text(t)),calendarHtml.location?($("#event-location").html("<b>Location: </b>"+calendarHtml.location),$("span.location").text(calendarHtml.location)):($("#event-location").html(""),$("span.location").text("")),$("#event-link").attr("href",calendarHtml.link),$("span.description").text(calendarHtml.link)}),$("#prev-newsletter").click(function(t){t.originalEvent&&clearInterval(l),$($("ol li")[i]).removeClass("active"),0===i?i=r-1:i--,e()}),$("#next-newsletter").click(function(t){t.originalEvent&&clearInterval(l),$($("ol li")[i]).removeClass("active"),i=(i+1)%r,e()});var d=/Android|iPhone|iPad|iPod/i.test(navigator.userAgent);d&&$(".show-login").empty(),Number.prototype.pad=function(e){return new Array(e).join("0").slice((e||2)*-1)+this};var u=$('<div id="overlay"></div>'),m=$('<div id="modal"></div>'),f=$('<a id="close" href="#">close</a>'),p=$('<div id="modal-content"></div>');m.hide(),u.hide(),m.append(p,f),$(".main-page-container").append(u,m),modal.initialize({$overlay:$("#overlay"),$modal:$("#modal"),$close:$("#close"),$content:$("#modal-content")}),$(".fa-archive").click(function(){var e=400,t=500;window_height=$(window).height(),window_width=$(window).width(),e=window_height<e?window_height-50:e,t=window_width<t?window_width-50:t,$("#modal").css({background:"white"});var n="<h1>View Previous Newsletters</h1> <ul class='newsletterList'> <li><a href='http://us1.campaign-archive2.com/?u=c8b5a41c875ce918bbd091e52&id=215199c3b2&e=38ee20bb08'>June 2016</a> </li><li><a href='http://us1.campaign-archive1.com/?u=c8b5a41c875ce918bbd091e52&id=00399bbff9&e=38ee20bb08'>May 2016</a> </li><li><a href='http://us1.campaign-archive2.com/?u=c8b5a41c875ce918bbd091e52&id=480dcd7865&e=38ee20bb08'>Mid-April 2016</a> </li><li><a href='http://us1.campaign-archive2.com/?u=c8b5a41c875ce918bbd091e52&id=17cac73925&e=38ee20bb08'>Early-April 2016</a></li><li><a href='http://us1.campaign-archive2.com/?u=c8b5a41c875ce918bbd091e52&id=a8f7a3cd22&e=38ee20bb08'>March 2016 </a></li><li><a href='http://us1.campaign-archive2.com/?u=c8b5a41c875ce918bbd091e52&id=ecb6bb1b8c&e=1365fed48c'>February 2016</a></li></ul>";modal.open({content:$(n),width:t+"px",height:e+"px",align:"center"})}),f.click(function(e){e.preventDefault(),modal.close()})});var ajaxUtils=function(){function e(e,t){$.ajax({method:"GET",url:p.newsletter}).done(function(n){if("object"!=typeof n)return void t("","GET method for "+p.newsletter+" failed.");for(var a={},o=0,i=n.newsletter.length,r=1;r<i;r++){var c=document.createElement("li");$(".carousel-indicators").append(c)}$($("ol li")[o]).addClass("active"),$("#title").append(n.newsletter[o].title),$("#title").attr("title",n.newsletter[o].title),$("#description").append("<span class = 'bold'> Description: </span>"+n.newsletter[o].description),$("#image-newsletter").attr("src","../assets/newsletter/newsletter"+n.newsletter[o].image+"?v="+e);var s=document.createElement("a");s.href=n.newsletter[o].image_link,$("#image-newsletter").wrap(s),n.newsletter[o].image_link?$("#image-newsletter").parent()[0].setAttribute("onclick","return true;"):$("#image-newsletter").parent()[0].setAttribute("onclick","return false;"),a.newsletterData=n,a.populatedItems=i,a.message="[GET] newsletter data successful.",t(a)}).fail(function(e){t("","GET method for "+p.newsletter+" failed.")})}function t(e){$.ajax({method:"GET",url:p.calendar}).done(function(t){if("object"!=typeof t)return void e("","GET method for "+p.calendar+" failed.");for(var n,a={},o=0,i=t,r=i.calendar.length,c=!1,s=new Date,d=s.getMonth(),m=s.getDate();c===!1;){calendarHtml=i.calendar[o],$("#event-title").html("<b>Event: </b>"+calendarHtml.event),$("span.title").text(calendarHtml.event);var f=l(calendarHtml.time);f.startTime?($("#event-date").html("<b>Date: </b>"+f.month+" "+f.day+", "+f.year+" at "+f.startTime),n=u(f.month,f.day,f.year,f.startTime),$("span.start").text(n),$("span.end").text(n)):($("#event-date").html("<b>Date: </b>"+f.month+" "+f.day+", "+f.year),n=u(f.month,f.day,f.year,""),$("span.start").text(n),$("span.end").text(n)),f.month<=d&&f.day<m?(i.calendar.splice(0,1),r--):(c=!0,calendarHtml.location?($("#event-location").html("<b>Location: </b>"+calendarHtml.location),$("span.location").text(calendarHtml.location)):$("span.location").text(""),$("#event-link").attr("href",calendarHtml.link),$("span.description").text(calendarHtml.link))}$("#calendar-loader").hide(),a.calendarData=i,a.numCalendarItems=r,e(a)}).fail(function(t){e("","GET method for "+p.calendar+" failed.")})}function n(e){$.ajax({method:"GET",url:p.announcements}).done(function(t){if("object"!=typeof t)return $(".fa-spinner").hide(),void e("GET method for "+p.announcements+" failed.");for(var n=t.announcements,a=t.announcements.length,o=a-1;o>-1;o--)m(n,o,0);$(".announcement-content-container").css({"text-align":"left"}),$(".fa-spinner").hide()}).fail(function(t){$(".announcement-content-container").css({"text-align":"left"}),$(".fa-spinner").hide(),e("GET method for "+p.announcements+" failed.")})}function a(e){$("#announcement-form").submit(function(t){var n=new Date,a=$(".form-announ #post-announcement").attr("data-login");return a?($.ajax({type:"POST",url:p.postAnnouncement,data:{officer:t.target.officer.value,timestamp:n,announcement:t.target.announcement.value}}).done(function(e){console.log("Announcement post successful!"),m(e.announcements,e.announcements.length-1,1)}).fail(function(t){e("Announcement "+p.postAnnouncement+" POST unsuccessful.")}),!1):(alert("Access Denied. How did you get here? You're not supposed to be here!"),e("Announcement post unsuccessful, not authenciated"),!1)})}function o(e){$.ajax({method:"GET",url:p.officers}).done(function(t){if("object"!=typeof t)return void e("GET method for "+p.officers+" failed. Unsupported return type.");for(var n=0,a=t.length;n<a;n++)$("select").append('<option value="'+t[n].name+'">'+t[n].name+"</option>")}).fail(function(t){e("GET method for "+p.officers+" failed.")})}function i(e){localStorage.getItem("credentials")&&$.ajax({method:"GET",url:p.officerLogin+"?credentials="+localStorage.getItem("credentials")}).done(function(t){return void 0===t?void e(p.officerLogin+" returned, unauthenticated error"):t.indexOf("404")>=0?void e(p.officerLogin+" returned, unauthenticated error"):void("OK"==t&&($(".post-announcement").css({display:"flex"}),$(".announcement-container").css({height:"250px"}),$(".show-login").empty(),$(".form-announ #post-announcement").attr("data-login",!0)))}).fail(function(){e(p.officerLogin+" returned, unauthenticated error")})}function r(e,t){var n=this,a=e.target.name.value,o=e.target.password.value;endcodedCredentials=btoa(a+":"+o),$.ajax({type:"POST",url:p.login,headers:{authorization:"Basic "+endcodedCredentials},json:!0,dataType:"json"}).done(function(e){var t=e.uuid;$(".form-announ #post-announcement").attr("data-login",!0),console.log("Login successful with UUID "+t),localStorage.setItem("credentials",t),$(".mes").hide(),$(n).find(".custom-button").text("Success!").css({background:"green"}),$(".post-announcement").show(),$(".announcement-container").css({height:"275px"}),setTimeout(function(){$(n).find(".custom-button").text("Login").css({background:"#337ab7"}),$(".close-modal").click()},1500)}).fail(function(e){$(n).find(".custom-button").text("Failure").css({background:"#D8000C"}),setTimeout(function(){$(n).find(".custom-button").text("Login").css({background:"#0137A2"}),$(".mes").show()},2500),t("Login unsuccessful.. Error Code: "+JSON.stringify(e))})}function c(e){var t=$("#subscribe-email").val();s(t)?($("#stat").css({color:"green"}),$("#stat").text("Subscription successful!"),$.ajax({type:"POST",url:p.subscribe,data:{name:"new user",email:t,phone:"n/a",category:"SHPE Austin: Newletter Subscription Request",message:"Please add "+t+" to the newsletter.",subscribe:!0}}).done(function(e){console.log("Success!")}).fail(function(t){e(t)}),setTimeout(function(){$("#subscribe-container").css({display:"none"}),$("#newsletter-buttons").show(),$(".fa-archive").show(),$(".fa-envelope").show(),$("#stat").text("Subscribe to our newsletter!"),$("#stat").css({color:"black"})},2500)):($("#stat").css({color:"red"}),$("#stat").text("Invalid e-mail."))}function s(e){var t=/(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))/;return t.test(e)}function l(e){var t=[],n=e.substring(0,e.indexOf("-"));e=e.substring(e.indexOf("-")+1,e.length);var a=e.substring(0,e.indexOf("-"));if(a=d(a),e=e.substring(e.indexOf("-")+1,e.length),day=e.substring(0,2),e.length>2){var o=e.substring(3,e.length),i=o.substring(0,5),r=parseInt(i);if(r>=12){if(r>12){var c=i.substring(2,i.length),s=parseInt(i.substring(0,2))-12;s/10<1&&(s=s.pad(2)),i=s+c}r="PM"}else r="AM";t.startTime=i+" "+r}else t.startTime="";return t.month=a,t.day=day,t.year=n,t}function d(e){switch(e=parseInt(e.replace(/^0+/,""))){case 1:return"January";case 2:return"February";case 3:return"March";case 4:return"April";case 5:return"May";case 6:return"June";case 7:return"July";case 8:return"August";case 9:return"September";case 10:return"October";case 11:return"November";case 12:return"December";default:return"Invalid Month"}}function u(e,t,n,a){return""===a&&(a="12:00 PM"),e=f.indexOf(e)+1,e/10<1&&(e=e.pad(2)),e+"/"+t+"/"+n+" "+a}function m(e,t,n){"undefined"==typeof t&&(t=e.length-1);var a='<p class="officer-post"> <span class="post-info"></span> <span class="post-content"></span></p>',o=e[t].officer,i=e[t].timestamp,r=e[t].announcement,c=new Date(i),s=c.toLocaleDateString(),l=c.toLocaleTimeString(),d=o+" ("+s+" @ "+l+")",u=$(a).find(".post-info")[0];$(u).text(d+" ");var m,f=$(a).find(".post-content")[0];if(new RegExp("([a-zA-Z0-9]+://)?([a-zA-Z0-9_]+:[a-zA-Z0-9_]+@)?([a-zA-Z0-9.-]+\\.[A-Za-z]{2,4})(:[0-9]+)?(/.*)?").test(r))for(var p=r.split(" "),h=0,b=p.length;h<b;h++)new RegExp("([a-zA-Z0-9]+://)?([a-zA-Z0-9_]+:[a-zA-Z0-9_]+@)?([a-zA-Z0-9.-]+\\.[A-Za-z]{2,4})(:[0-9]+)?(/.*)?").test(p[h])&&(m=document.createElement("a"),m.setAttribute("href",p[h]),m.text="(Attached link)");$(f).html(r+" "),$(f).append(m);var g='<p class="officer-post">',v=g;v=$(v).append(u),v=$(v).append(f),0===n?$(".announcement-content-container").append(v):1===n&&$(".announcement-content-container").prepend(v)}var f=["January","February","March","April","May","June","July","August","September","October","November","December"],p={newsletter:"/data/newsletterdata",calendar:"/data/calendar",announcements:"/data/announcements",officers:"/data/officerList",officerLogin:"/data/officerlogin",postAnnouncement:"/update/announcements",login:"/authentication/login",subscribe:"/communication/contact"};return{getNewsletterData:e,getCalendarData:t,getAnnouncements:n,postAnnouncement:a,getOfficers:o,getAuthentication:i,login:r,subscribe:c,_parseCalendarTime:l,_convertToDateFormat:u}}(),modal=function(){var e,t,n,a,o={};return o.initialize=function(o){console.log("Initializing modal..."),e=o.$content,t=o.$close,n=o.$overlay,a=o.$modal},o.center=function(){var e,t;e=Math.max($(window).height()-a.outerHeight(),0)/2,t=Math.max($(window).width()-a.outerWidth(),0)/2,a.css({top:e+$(window).scrollTop(),left:t+$(window).scrollLeft()})},o.open=function(t){e.empty().append(t.content),a.css({width:t.width-10||"auto",height:t.height-10||"auto","text-align":t.align}),e.css({width:t.width||"auto",height:t.height||"auto"}),o.center(),$(window).bind("resize.modal",o.center),a.show(),n.show()},o.close=function(){a.hide(),n.hide(),e.empty(),$(window).unbind("resize.modal")},$(document).keydown(function(e){27==e.keyCode&&$("#close").click()}),o}();