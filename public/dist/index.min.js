$(document).ready(function(){var e,t,n=io(),a=0,o=0;n.emit("revision","Get revision number from backend."),n.on("revision",function(t){console.log("Revision is: "+t),e=t}),"/"==window.location.pathname&&(ajaxUtils.getCalendarData(function(e,n){return n?void console.error(n):(t=e.calendarData,a=t.length,$(".fa-angle-double-right").click(),void $(".fa-angle-double-left").click())}),ajaxUtils.getAnnouncements(function(e){e&&console.error(e)}),ajaxUtils.getOfficers(function(e){e&&console.error(e)}),ajaxUtils.getAuthentication(function(e){e&&console.error(e)})),ajaxUtils.postAnnouncement(function(e){e&&console.error(e)}),$("#login-form").submit(function(e){return ajaxUtils.login.call(this,e,function(e){e&&console.error(e)}),!1}),$(".cal-button").on("click",function(e){$(e.currentTarget).hasClass("fa-angle-double-right")?o=(o+1)%a:(o--,o<0&&(o=a-1)),$(".fa-calendar").toggleClass("dark-shpe-blue mid-blue");var n=t[o];$("#event-title").html("<b>Event: </b>"+n.event),$("span.title").text(n.event);var i,r=ajaxUtils._parseCalendarTime(n.time);r.startTime?($("#event-date").html("<b>Date: </b>"+r.month+" "+r.day+", "+r.year+" at "+r.startTime),i=ajaxUtils._convertToDateFormat(r.month,r.day,r.year,r.startTime),$("span.start").text(i),$("span.end").text(i)):($("#event-date").html("<b>Date: </b>"+r.month+" "+r.day+", "+r.year),i=ajaxUtils._convertToDateFormat(r.month,r.day,r.year,r.startTime,""),$("span.start").text(i),$("span.end").text(i)),n.location?($("#event-location").html("<b>Location: </b>"+n.location),$("span.location").text(n.location)):($("#event-location").html(""),$("span.location").text("")),$("#event-link").attr("href",n.link),$("span.description").text(n.link)});var i=/Android|iPhone|iPad|iPod/i.test(navigator.userAgent);i&&$(".show-login").empty(),Number.prototype.pad=function(e){return new Array(e).join("0").slice((e||2)*-1)+this},$(document).keydown(function(e){13==e.keyCode?$("#subscribe-container").is(":visible")&&$("#subscribe-email").is(":focus")&&$(".fa-envelope-o").click():27==e.keyCode&&$("#subscribe-container").is(":visible")&&$("#close-subscribe").click()})});var ajaxUtils=function(){function e(e,t){$.ajax({method:"GET",url:p.newsletter}).done(function(n){if("object"!=typeof n)return void t("","GET method for "+p.newsletter+" failed.");$("#newsletter-loader").hide();for(var a={},o=0,i=n.newsletter.length,r=1;r<i;r++){var s=document.createElement("li");$(".carousel-indicators").append(s)}$($("ol li")[o]).addClass("active"),$("#title").append(n.newsletter[o].title),$("#title").attr("title",n.newsletter[o].title),$("#description").append("<span class = 'bold'> Description: </span>"+n.newsletter[o].description),$("#image-newsletter").attr("src","../assets/newsletter/newsletter"+n.newsletter[o].image+"?v="+e);var c=document.createElement("a");c.href=n.newsletter[o].image_link,$("#image-newsletter").wrap(c),n.newsletter[o].image_link?$("#image-newsletter").parent()[0].setAttribute("onclick","return true;"):$("#image-newsletter").parent()[0].setAttribute("onclick","return false;"),a.newsletterData=n,a.populatedItems=i,a.message="[GET] newsletter data successful.",t(a)}).fail(function(e){t("","GET method for "+p.newsletter+" failed.")})}function t(e){$.ajax({method:"GET",url:p.calendar}).done(function(t){if("object"!=typeof t)return void e("","GET method for "+p.calendar+" failed.");var n=new Date;n=n.getTime(),t.calendar=t.calendar.filter(function(e){var t=new Date(e.time).getTime();return t>=n});var a,o={},i=t.calendar;i.forEach(function(e){$("#event-title").html("<b>Event: </b>"+e.event),$("span.title").text(e.event);var t=l(e.time);t.startTime?($("#event-date").html("<b>Date: </b>"+t.month+" "+t.day+", "+t.year+" at "+t.startTime),a=d(t.month,t.day,t.year,t.startTime),$("span.start").text(a),$("span.end").text(a)):($("#event-date").html("<b>Date: </b>"+t.month+" "+t.day+", "+t.year),a=d(t.month,t.day,t.year,""),$("span.start").text(a),$("span.end").text(a)),e.location?($("#event-location").html("<b>Location: </b>"+e.location),$("span.location").text(e.location)):$("span.location").text(""),$("#event-link").attr("href",e.link),$("span.description").text(e.link)}),$("#calendar-loader").hide(),o.calendarData=i,e(o)}).fail(function(t){e("","GET method for "+p.calendar+" failed.")})}function n(e){$.ajax({method:"GET",url:p.announcements}).done(function(t){if("object"!=typeof t)return $(".fa-spinner").hide(),void e("GET method for "+p.announcements+" failed.");for(var n=t.announcements,a=t.announcements.length,o=a-1;o>-1;o--)f(n,o,0);$(".announcement-content-container").css({"text-align":"left"}),$(".fa-spinner").hide()}).fail(function(t){$(".announcement-content-container").css({"text-align":"left"}),$(".fa-spinner").hide(),e("GET method for "+p.announcements+" failed.")})}function a(e){$("#announcement-form").submit(function(t){var n=new Date,a=$(".form-announ #post-announcement").attr("data-login");return a?($.ajax({type:"POST",url:p.postAnnouncement,data:{officer:t.target.officer.value,timestamp:n,announcement:t.target.announcement.value}}).done(function(e){console.log("Announcement post successful!"),f(e.announcements,e.announcements.length-1,1)}).fail(function(t){e("Announcement "+p.postAnnouncement+" POST unsuccessful.")}),!1):(alert("Access Denied. How did you get here? You're not supposed to be here!"),e("Announcement post unsuccessful, not authenciated"),!1)})}function o(e){$.ajax({method:"GET",url:p.officers}).done(function(t){if("object"!=typeof t)return void e("GET method for "+p.officers+" failed. Unsupported return type.");for(var n=0,a=t.length;n<a;n++)$("select").append('<option value="'+t[n].name+'">'+t[n].name+"</option>")}).fail(function(t){e("GET method for "+p.officers+" failed.")})}function i(e){localStorage.getItem("credentials")&&$.ajax({method:"GET",url:p.officerLogin+"?credentials="+localStorage.getItem("credentials")}).done(function(t){return void 0===t?void e(p.officerLogin+" returned, unauthenticated error"):t.indexOf("404")>=0?void e(p.officerLogin+" returned, unauthenticated error"):void("OK"==t&&($(".post-announcement").css({display:"flex"}),$(".announcement-container").css({height:"250px"}),$(".show-login").empty(),$(".form-announ #post-announcement").attr("data-login",!0)))}).fail(function(){e(p.officerLogin+" returned, unauthenticated error")})}function r(e,t){var n=this,a=e.target.name.value,o=e.target.password.value;endcodedCredentials=btoa(a+":"+o),$.ajax({type:"POST",url:p.login,headers:{authorization:"Basic "+endcodedCredentials},json:!0,dataType:"json"}).done(function(e){var t=e.uuid;$(".form-announ #post-announcement").attr("data-login",!0),console.log("Login successful with UUID "+t),localStorage.setItem("credentials",t),$(".mes").hide(),$(n).find(".custom-button").text("Success!").css({background:"green"}),$(".post-announcement").show(),$(".announcement-container").css({height:"275px"}),setTimeout(function(){$(n).find(".custom-button").text("Login").css({background:"#337ab7"}),$(".close-modal").click()},1500)}).fail(function(e){$(n).find(".custom-button").text("Failure").css({background:"#D8000C"}),setTimeout(function(){$(n).find(".custom-button").text("Login").css({background:"#0137A2"}),$(".mes").show()},2500),t("Login unsuccessful.. Error Code: "+JSON.stringify(e))})}function s(e){var t=$("#subscribe-email").val();c(t)?($("#stat").css({color:"green"}),$("#stat").text("Subscription successful!"),$.ajax({type:"POST",url:p.subscribe,data:{name:"new user",email:t,phone:"n/a",category:"SHPE Austin: Newletter Subscription Request",message:"Please add "+t+" to the newsletter.",subscribe:!0}}).done(function(e){console.log("Success!")}).fail(function(t){e(t)}),setTimeout(function(){$("#subscribe-container").css({display:"none"}),$("#newsletter-buttons").show(),$(".fa-archive").show(),$(".fa-envelope").show(),$("#stat").text("Subscribe to our newsletter!"),$("#stat").css({color:"black"})},2500)):($("#stat").css({color:"red"}),$("#stat").text("Invalid e-mail."))}function c(e){var t=/(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))/;return t.test(e)}function l(e){var t=[],n=e.substring(0,e.indexOf("-"));e=e.substring(e.indexOf("-")+1,e.length);var a=e.substring(0,e.indexOf("-"));if(a=u(a),e=e.substring(e.indexOf("-")+1,e.length),day=e.substring(0,2),e.length>2){var o=e.substring(3,e.length),i=o.substring(0,5),r=parseInt(i);if(r>=12){if(r>12){var s=i.substring(2,i.length),c=parseInt(i.substring(0,2))-12;c/10<1&&(c=c.pad(2)),i=c+s}r="PM"}else r="AM";t.startTime=i+" "+r}else t.startTime="";return t.month=a,t.day=day,t.year=n,t}function u(e){switch(e=parseInt(e.replace(/^0+/,""))){case 1:return"January";case 2:return"February";case 3:return"March";case 4:return"April";case 5:return"May";case 6:return"June";case 7:return"July";case 8:return"August";case 9:return"September";case 10:return"October";case 11:return"November";case 12:return"December";default:return"Invalid Month"}}function d(e,t,n,a){return""===a&&(a="12:00 PM"),e=m.indexOf(e)+1,e/10<1&&(e=e.pad(2)),e+"/"+t+"/"+n+" "+a}function f(e,t,n){"undefined"==typeof t&&(t=e.length-1);var a='<p class="officer-post"> <span class="post-info"></span> <span class="post-content"></span></p>',o=e[t].officer,i=e[t].timestamp,r=e[t].announcement,s=new Date(i),c=s.toLocaleDateString(),l=s.toLocaleTimeString(),u=o+" ("+c+" @ "+l+")",d=$(a).find(".post-info")[0];$(d).text(u+" ");var f,m=$(a).find(".post-content")[0];if(new RegExp("([a-zA-Z0-9]+://)?([a-zA-Z0-9_]+:[a-zA-Z0-9_]+@)?([a-zA-Z0-9.-]+\\.[A-Za-z]{2,4})(:[0-9]+)?(/.*)?").test(r))for(var p=r.split(" "),h=0,g=p.length;h<g;h++)new RegExp("([a-zA-Z0-9]+://)?([a-zA-Z0-9_]+:[a-zA-Z0-9_]+@)?([a-zA-Z0-9.-]+\\.[A-Za-z]{2,4})(:[0-9]+)?(/.*)?").test(p[h])&&(f=document.createElement("a"),f.setAttribute("href",p[h]),f.text="(Attached link)");r=r.replace(/\n/g,"<br /><br />"),$(m).html(r+" "),$(m).append(f);var b='<p class="officer-post">',v=b;v=$(v).append(d),v=$(v).append(m),0===n?$(".announcement-content-container").append(v):1===n&&$(".announcement-content-container").prepend(v)}var m=["January","February","March","April","May","June","July","August","September","October","November","December"],p={newsletter:"/data/newsletterdata",calendar:"/data/calendar",announcements:"/data/announcements",officers:"/data/officerList",officerLogin:"/data/officerlogin",postAnnouncement:"/update/announcements",login:"/authentication/login",subscribe:"/communication/contact"};return{getNewsletterData:e,getCalendarData:t,getAnnouncements:n,postAnnouncement:a,getOfficers:o,getAuthentication:i,login:r,subscribe:s,_parseCalendarTime:l,_convertToDateFormat:d}}(),modal=function(){var e,t,n,a,o={};return o.initialize=function(o){console.log("Initializing modal..."),e=o.$content,t=o.$close,n=o.$overlay,a=o.$modal},o.center=function(){var e,t;e=Math.max($(window).height()-a.outerHeight(),0)/2,t=Math.max($(window).width()-a.outerWidth(),0)/2,a.css({top:e+$(window).scrollTop(),left:t+$(window).scrollLeft()})},o.open=function(t){e.empty().append(t.content),a.css({width:t.width-10||"auto",height:t.height-10||"auto","text-align":t.align}),e.css({width:t.width||"auto",height:t.height||"auto"}),o.center(),$(window).bind("resize.modal",o.center),a.show(),n.show()},o.close=function(){a.hide(),n.hide(),e.empty(),$(window).unbind("resize.modal")},$(document).keydown(function(e){27==e.keyCode&&$("#close").click()}),o}();