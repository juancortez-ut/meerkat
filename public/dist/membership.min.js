var CALENDAR=function(){function e(e){o=$(e||"#cal"),c=o.find("#label"),o.find("#prev").bind("click.calendar",function(){t(!1),u--,0>u&&(u=11),n()}),o.find("#next").bind("click.calendar",function(){t(!0),u=(u+1)%12,n()}),c.bind("click",function(){t(null,(new Date).getMonth(),(new Date).getFullYear())}),c.click()}function t(e,t,n){var a,r=c.text().trim().split(" "),l=parseInt(r[1],10);t=t||(e?"December"===r[0]?0:d.indexOf(r[0])+1:"January"===r[0]?11:d.indexOf(r[0])-1),n=n||(e&&0===t?l+1:e||11!==t?l:l-1),a=i(n,t),$("#cal-frame",o).find(".curr").removeClass("curr").addClass("temp").end().prepend(a.calendar()).find(".temp").fadeOut("slow",function(){$(this).remove()}),$("#label").text(a.label)}function n(){numCalendarItems=l.calendar.length;for(var e=0;e<numCalendarItems;e++){calendarHtml=l.calendar[e];var t=a(calendarHtml.time);if(r(u+1)==t.month){var n=t.day;n=parseInt(n.replace(/^0+/,""));var i=$('td:contains("'+n+'")')[0];n==s.getDate()&&$(i).removeClass("today"),$(i).addClass("forest-green"),i.setAttribute("data-date",t.month+" "+n+" "+t.year),i.setAttribute("data-event",calendarHtml.event),calendarHtml.location&&i.setAttribute("data-location",calendarHtml.location),i.setAttribute("data-link",calendarHtml.link),$(i).css({cursor:"pointer"})}}}function a(e){var t=[],n=e.substring(0,e.indexOf("-"));e=e.substring(e.indexOf("-")+1,e.length);var a=e.substring(0,e.indexOf("-"));if(a=r(a),e=e.substring(e.indexOf("-")+1,e.length),day=e.substring(0,2),e.length>2){var i=e.substring(3,e.length),o=i.substring(0,5),c=parseInt(o.replace(/^0+/,""));if(c>=12){if(c>12){var l=o.substring(2,o.length),d=parseInt(o.substring(0,2))-12;o=d+l}c="P.M."}else c="A.M.";o=o.replace(/^0+/,""),t.startTime=o+" "+c}else t.startTime="";return t.month=a,t.day=day,t.year=n,t}function r(e){switch(e.length>1&&(e=parseInt(e.replace(/^0+/,""))),e){case 1:return"January";case 2:return"February";case 3:return"March";case 4:return"April";case 5:return"May";case 6:return"June";case 7:return"July";case 8:return"August";case 9:return"September";case 10:return"October";case 11:return"November";case 12:return"December";default:return"Invalid Month"}}function i(e,t){var n,a,r=1,o=!0,c=new Date(e,t,r).getDay(),l=[31,e%4===0&&e%100!==0||e%400===0?29:28,31,30,31,30,31,31,30,31,30,31],s=[];if(i.cache[e]){if(i.cache[e][t])return i.cache[e][t]}else i.cache[e]={};for(n=0;o;){for(s[n]=[],a=0;7>a;a++)0===n?a===c&&(s[n][a]=r++,c++):r<=l[t]?s[n][a]=r++:(s[n][a]="",o=!1),r>l[t]&&(o=!1);n++}if(s[5]){for(n=0;n<s[5].length;n++)""!==s[5][n]&&(s[4][n]="<span>"+s[4][n]+"</span><span>"+s[5][n]+"</span>");s=s.slice(0,5)}for(n=0;n<s.length;n++)s[n]="<tr><td>"+s[n].join("</td><td>")+"</td></tr>";return s=$("<table>"+s.join("")+"</table>").addClass("curr"),$("td:empty",s).addClass("nil"),t===(new Date).getMonth()&&$("td",s).filter(function(){return $(this).text()===(new Date).getDate().toString()}).addClass("today"),i.cache[e][t]={calendar:function(){return s.clone()},label:d[t]+" "+e},i.cache[e][t]}var o,c,l,d=["January","February","March","April","May","June","July","August","September","October","November","December"],s=new Date,u=s.getMonth();return $.ajax({method:"GET",url:"/calendardata"}).done(function(e){l=e,n()}),$(".glyphicon-remove-sign").click(function(){$("#cal-info").hide()}),$("#cal").click(function(e){if(e.originalEvent&&"forest-green"==e.toElement.classList[0]){if("glyphicon"==e.toElement.classList[0])return;var t=$(e.toElement).attr("data-event"),n=$(e.toElement).attr("data-location");if("undefined"!=typeof t&&t!==!1){var a=$(e.toElement).attr("data-event");$("#event").text(a);var r=$(e.toElement).attr("data-date");$("#date").text(r),"undefined"!=typeof n&&n!==!1?($(".locationWrapper").css({display:"block"}),$("#location").text(n)):$(".locationWrapper").css({display:"none"});var i=document.createElement("a");i.href=$(e.toElement).attr("data-link"),$("#calLink").wrap(i)}$("#cal-info").show()}}),i.cache={},{init:e,switchMonth:t,createCal:i}},modal=function(){var e={},t=$('<div id="overlay"></div>');return $modal=$('<div id="modal"></div>'),$content=$('<div id="content"></div>'),$close=$('<a id="close" href="#">close</a>'),$modal.hide(),t.hide(),$modal.append($content,$close),e.center=function(){var e,t;e=Math.max($(window).height()-$modal.outerHeight(),0)/2,t=Math.max($(window).width()-$modal.outerWidth(),0)/2,$modal.css({top:e+$(window).scrollTop(),left:t+$(window).scrollLeft()})},e.open=function(n){$content.empty().append(n.content),$modal.css({width:n.width-10||"auto",height:n.height-10||"auto","text-align":n.align}),$content.css({width:n.width||"auto",height:n.height||"auto"}),e.center(),$(window).bind("resize.modal",e.center),$modal.show(),t.show()},e.close=function(){$modal.hide(),t.hide(),$content.empty(),$(window).unbind("resize.modal")},$(document).ready(function(){$("body").append(t,$modal),$close.click(function(t){t.preventDefault(),e.close()}),$(".fa-info-circle").click(function(){var e=this.getAttribute("data"),t=400,n=500;window_height=$(window).height(),window_width=$(window).width(),t=window_height<t?window_height-50:t,n=window_width<n?window_width-50:n,modal.open({content:$("<h2>"+e+"</h2>"),width:n+"px",height:t+"px",align:"center"})}),$(document).keydown(function(e){27==e.keyCode&&$("#close").click()})}),e}();